# Timao N8N Document Conversion Pipeline

This repository contains scripts and instructions for converting structured Word (.docx) files into Excel (.xlsx) format, enriching them using n8n and GPT outputs, and converting the results back to a properly formatted .docx file.

---

## ðŸ§± Folder Structure

```
Timao/
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ README.md
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ recherches.py
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ docx_to_xlsx.py         # Converts DOCX to structured XLSX
â”‚   â””â”€â”€ xlsx_to_docx.py         # Converts enriched XLSX back to DOCX
â”œâ”€â”€ files/
â”‚   â”œâ”€â”€ source_input.docx       # Input DOCX file with numbered hierarchy
â”‚   â”œâ”€â”€ structured_output.xlsx  # XLSX file generated by docx_to_xlsx.py
â”‚   â”œâ”€â”€ enriched_output.xlsx    # XLSX file enriched by n8n (with GPT outputs)
â”‚   â””â”€â”€ final_output.docx       # Final formatted DOCX with GPT outputs inserted
â””â”€â”€ tests/                      # (Optional) for future testing setup
```

---

## ðŸ§­ Workflow Overview

1. **Start with** a `.docx` file that uses numbered headings (e.g., 1, 1.1, 1.1.1, etc.).
   - Place this in `files/` and name it: `source_input.docx`

2. **Convert to Excel** using the script `scripts/docx_to_xlsx.py`:

   ```bash
   docker run --rm \
     -v ~/Projects/Timao/scripts:/data/scripts \
     -v ~/Projects/Timao/files:/data/files \
     python:3.10 \
     /bin/bash -c "pip install -r /data/scripts/requirements.txt && \
                   python3 /data/scripts/docx_to_xlsx.py /data/files/source_input.docx /data/files/structured_output.xlsx"
   ```

3. **Enrich `structured_output.xlsx` using n8n**.
   - This process adds GPT outputs (columns like `gpt_summary`, `gpt_keywords`, etc.).
   - Export the enriched result to `files/enriched_output.xlsx`.

4. **Convert back to DOCX** using the script `scripts/xlsx_to_docx.py`:

   ```bash
   docker run --rm \
     -v ~/Projects/Timao/scripts:/data/scripts \
     -v ~/Projects/Timao/files:/data/files \
     python:3.10 \
     /bin/bash -c "pip install -r /data/scripts/requirements.txt && \
                   python3 /data/scripts/xlsx_to_docx.py /data/files/enriched_output.xlsx /data/files/final_output.docx"
   ```

---

## ðŸ”§ Required Python Packages
These are defined in `requirements.txt`:

```
openpyxl
python-docx
```

To manually install in a local environment:
```bash
pip install -r requirements.txt
```

---

## ðŸ“Œ Notes

- Only rows with a non-empty `CCTP` field are processed for GPT outputs.
- The numbering logic mimics the original `source_input.docx`, maintaining continuity like `1`, `1.1`, `1.1.1` throughout.
- GPT outputs are inserted **under** the `CCTP` paragraph for each section.
- You can customize output styles in `xlsx_to_docx.py` if needed.

---

## ðŸ’¡ Example Input/Output

| Input | Output |
|-------|--------|
| source_input.docx | structured_output.xlsx |
| structured_output.xlsx (enriched) | enriched_output.xlsx |
| enriched_output.xlsx | final_output.docx |