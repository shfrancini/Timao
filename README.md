# Timao N8N Document Conversion Pipeline

This repository contains scripts and instructions for converting structured Word (.docx) files into Excel (.xlsx) format, enriching them using n8n and GPT outputs, and converting the results back to a properly formatted .docx file.

---

## ðŸ§± Folder Structure

```
Timao/
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ README.md
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ recherches.py
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ docx_to_xlsx.py         # Converts DOCX to structured XLSX
â”‚   â””â”€â”€ xlsx_to_docx.py         # Converts enriched XLSX back to DOCX
â”œâ”€â”€ files/
â”‚   â”œâ”€â”€ source_input.docx       # Original input file, with numbered hierarchy
â”‚   â”œâ”€â”€ output.xlsx             # XLSX file generated by docx_to_xlsx.py
â”‚   â””â”€â”€ output.docx             # Final formatted DOCX with GPT outputs inserted
â””â”€â”€ tests/                      # (Optional) for future testing setup
```

---

## ðŸ§­ Workflow Overview

1. **Start with** a `.docx` file that uses numbered headings (e.g., 1, 1.1, 1.1.1, etc.).
   - Place this in `files/` and name it: `source_input.docx`

2. **Convert to Excel** using the script `scripts/docx_to_xlsx.py`:

   ```bash
   docker run --rm \
     -v ~/Projects/Timao/scripts:/data/scripts \
     -v ~/Projects/Timao/files:/data/files \
     python:3.10 \
     /bin/bash -c "pip install -r /data/scripts/requirements.txt && \
                   python3 /data/scripts/docx_to_xlsx.py /data/files/source_input.docx /data/files/output.xlsx"
   ```

3. **Enrich `output.xlsx` using n8n**.
   - This process adds GPT outputs (columns like `gpt_summary`, `gpt_keywords`, etc.).
   - Export the enriched result, overwriting or renaming as needed (e.g. same `output.xlsx`).

4. **Convert back to DOCX** using the script `scripts/xlsx_to_docx.py`:

   ```bash
   docker run --rm \
     -v ~/Projects/Timao/scripts:/data/scripts \
     -v ~/Projects/Timao/files:/data/files \
     python:3.10 \
     /bin/bash -c "pip install -r /data/scripts/requirements.txt && \
                   python3 /data/scripts/xlsx_to_docx.py /data/files/output.xlsx /data/files/output.docx"
   ```

---

## ðŸ”§ Required Python Packages
These are defined in `requirements.txt`:

```
openpyxl
python-docx
```

To manually install in a local environment:
```bash
pip install -r requirements.txt
```

---

## ðŸ§  GPT Agent Customization

To change how GPT responses appear under each `CCTP` block:

### ðŸ”§ Modify the GPT prompt in your assistant (used in n8n):
Example prompt:
```text
Format your response with:
- A bold heading
- Bulleted list
- Formal tone
```
You can change it to include:
- Numbered lists
- Markdown headers
- Specific phrase markers

### ðŸŽ¨ Modify how GPT outputs are styled in `xlsx_to_docx.py`:

Edit the block:
```python
para = doc.add_paragraph(str(response))
```
Add logic to format the font, spacing, or layout using `python-docx`, e.g.:
```python
run.font.bold = True
run.font.size = Pt(11)
```

---

## ðŸ“Œ Notes

- Only rows with a non-empty `CCTP` field are processed for GPT outputs.
- The numbering logic mimics the original `source_input.docx`, maintaining continuity like `1`, `1.1`, `1.1.1` throughout.
- GPT outputs are inserted **under** the `CCTP` paragraph for each section.
- You can customize output styles in `xlsx_to_docx.py` if needed.

---

## ðŸ’¡ Example File Flow

| File                     | Purpose                               |
|--------------------------|----------------------------------------|
| `source_input.docx`      | Original input file (to convert)       |
| `output.xlsx`            | Output from DOCXâ†’XLSX conversion       |
| `output.xlsx` (enriched) | Updated in n8n with GPT responses      |
| `output.docx`            | Final formatted DOCX output            |