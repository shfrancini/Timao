{
  "name": "My workflow",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -140,
        -160
      ],
      "id": "86f3c0a4-4f25-4ed7-a138-c36c61c16dd2",
      "name": "When clicking ‘Execute workflow’"
    },
    {
      "parameters": {
        "operation": "xlsx",
        "binaryPropertyName": "file",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        380,
        0
      ],
      "id": "7277df0f-3b11-4265-897a-001c9d215ce1",
      "name": "Extract from File",
      "executeOnce": false,
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "fileSelector": "/Downloads/structured_output.xlsx",
        "options": {
          "dataPropertyName": "data"
        }
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        120,
        240
      ],
      "id": "b30fa984-c383-499b-9139-d24f0ef67946",
      "name": "Read/Write Files from Disk1",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "db535c1e-ca83-4747-9155-2369e8af41de",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        160,
        60
      ],
      "id": "21b694b9-9923-4145-81a2-bfd88584272d",
      "name": "Webhook",
      "webhookId": "db535c1e-ca83-4747-9155-2369e8af41de"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        640,
        40
      ],
      "id": "991f110c-6dc9-4e6f-a80f-b0b34853fa2e",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "content": "chat input here - after every row, go to chat, get output, and add it to excel. when done, you're done"
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1220,
        300
      ],
      "id": "a954148d-d3ad-4c54-b262-90ff983566cc",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "jsCode": "const item = items[0].json;\n\n// Get all keys (column names) for this row, in order\nconst columns = Object.keys(item);\n\n// Assuming CCTP is always the rightmost column (last column)\nconst cctpKey = columns[columns.length - 1];\nconst cctp = item[cctpKey] || '';\n\n// All other columns before CCTP are considered headers\nconst headerKeys = columns.slice(0, columns.length - 1);\n\n// Build context string from all header columns (non-empty only)\nconst contextParts = [];\n\nfor (const key of headerKeys) {\n  const value = item[key];\n  if (value && value.trim() !== '') {\n    contextParts.push(value.trim());\n  }\n}\n\nconst context = contextParts.join(' > ');\n\n// Build prompt string\nconst prompt = `Context: ${context}\\n\\nCCTP Content:\\n${cctp}\\n\\nPlease analyze this section and provide your output.`;\n\n// Return the whole row data plus context and prompt\nreturn [\n  {\n    json: {\n      ...item,    // keep all original columns\n      context,\n      prompt,\n      cctpKey,    // if you want to know which column was the CCTP\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        920,
        140
      ],
      "id": "69789337-1063-46df-ad22-d720420c2faa",
      "name": "Loop through Rows,"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.openai.com/v1/chat/completions",
        "sendQuery": true,
        "specifyQuery": "=json",
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1140,
        140
      ],
      "id": "a728e790-58c7-4a5a-9462-08f80b019b11",
      "name": "HTTP Request"
    }
  ],
  "pinData": {},
  "connections": {
    "When clicking ‘Execute workflow’": {
      "main": [
        []
      ]
    },
    "Read/Write Files from Disk1": {
      "main": [
        []
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Extract from File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "Loop through Rows,",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop through Rows,": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "86a859de-a6be-46ba-a0dc-a670b48b2aab",
  "meta": {
    "instanceId": "a2d54a98f418cef6d40b0863e1b53d101ea47676d974cd78ef8e069c18735a3d"
  },
  "id": "Aedyc0X98FB4SqFZ",
  "tags": []
}